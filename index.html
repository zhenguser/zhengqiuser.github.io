<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

	<style type="text/css">

		body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#allmap{height:500px;width:100%;}
		#r-result{width:100%; font-size:14px;}
		#v-result{width:100%; font-size:14px;}
		#v-distance{width:100%; font-size:14px;}

	</style>

	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=PlhFWpA02aoURjAOpnWcRGqw7AI8EEyO"></script>

	<title>城市名定位</title>
</head>
<body>


	<div id="allmap" onClick="change()"></div>

	<div id="v-result">
	当前地图显示范围：
		经度:<span id="vlongitude" style="width:100px; margin-right:10px;"></span> 
		纬度:<span id="vlatitude" style="width:100px; margin-right:10px;"></span> 
	</div>

	<div id="r-result">
	请输入无人机方位：
		经度: <input id="longitude" type="text" style="width:100px; margin-right:10px;" />
		纬度: <input id="latitude" type="text" style="width:100px; margin-right:10px;" />
		<input type="button" value="开始测向" onClick="theLocation()" />
	</div>    	

	<div id="v-distance">
		目标距离为：<span id="vdist" style="width:100px; margin-right:10px;"></span> 
	</div>


</body>
</html>

<script type="text/javascript">
	

	// 百度地图API功能
	var map = new BMap.Map("allmap");
	map.centerAndZoom(new BMap.Point(121.22,31.03),16);
	//map.enableScrollWheelZoom(true);
	
	//显示当前地图可视范围
	var bs = map.getBounds();   //获取可视区域
	var bssw = bs.getSouthWest();   //可视区域左下角
	var bsne = bs.getNorthEast();   //可视区域右上角
	//alert("当前地图可视范围是：" + bssw.lng + "," + bssw.lat + "到" + bsne.lng + "," + bsne.lat);	
	var vbssw = document.getElementById("vlongitude");
	var vbsne = document.getElementById("vlatitude");
	vbssw.innerHTML = bssw.lng+"~"+bsne.lng;
	vbsne.innerHTML = bssw.lat +"~"+bsne.lat;

	
	
	//计算中心点并标注
	var pointA = new BMap.Point((bssw.lng+bsne.lng)/2,(bssw.lat+bsne.lat)/2);  // 创建点坐标A--大渡口区
	var Amarker = new BMap.Marker(pointA);  // 创建标注
	map.addOverlay(Amarker);              // 将标注添加到地图
	//map.removeOverlay(Amarker);	
	
	//事件函数
	function change(){
		//alert("城市改变了..");
		map.clearOverlays();
		var bs = map.getBounds();   //获取可视区域
		var bssw = bs.getSouthWest();   //可视区域左下角
		var bsne = bs.getNorthEast();   //可视区域右上角
		//alert("当前地图可视范围是：" + bssw.lng + "," + bssw.lat + "到" + bsne.lng + "," + bsne.lat);	
		var vbssw = document.getElementById("vlongitude");
		var vbsne = document.getElementById("vlatitude");
		vbssw.innerHTML = bssw.lng+"~"+bsne.lng;
		vbsne.innerHTML = bssw.lat +"~"+bsne.lat;

	
	
		//计算中心点并标注
		var pointA = new BMap.Point((bssw.lng+bsne.lng)/2,(bssw.lat+bsne.lat)/2);  // 创建点坐标A--大渡口区
		var Amarker = new BMap.Marker(pointA);  // 创建标注
		map.addOverlay(Amarker);              // 将标注添加到地图
		//map.removeOverlay(Amarker);	
	}
	
	
	// 用经纬度设置地图中心点
	function theLocation(){
		if(document.getElementById("longitude").value != "" && document.getElementById("latitude").value != ""){
			map.clearOverlays(); 
			var pointB = new BMap.Point(document.getElementById("longitude").value,document.getElementById("latitude").value);
			/*
			var marker = new BMap.Marker(new_point);  // 创建标注
			map.addOverlay(marker);              // 将标注添加到地图中
			map.panTo(new_point);     
			*/
			
			//var pointB = new BMap.Point(116.4045,39.985);  // 创建点坐标B--江北区
		   // alert('从大渡口区到江北区的距离是：'+(map.getDistance(pointA,pointB)).toFixed(2)+' 米。');  //获取两点距离,保留小数点后两位
			var vdis = document.getElementById("vdist");
			var abdistance = (map.getDistance(pointA,pointB)).toFixed(2);
			vdis.innerHTML = abdistance+"米。";
			
			var polyline = new BMap.Polyline([pointA,pointB], {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5});  //定义折线
			map.addOverlay(polyline);     //添加折线到地图
			
			
			 
		}
	}
</script>
